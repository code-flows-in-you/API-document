swagger: '2.0'
info:
  description: 'SpareMoney API Document'
  version: '1.0.0'
  title: 'SpareMoney'
host: '118.89.65.154:8765'
basePath: '/'

tags:
- name: 'Account'
  description: '账户'
- name: 'Assignment'
  description: '任务'
- name: 'Questionnaire'
  description: '问卷'
- name: 'Question & Answer'
  description: '懂了么'
- name: 'Coin'
  description: '闲钱'
- name: 'System'
  description: '系统'
schemes:
- 'http'

paths:
  /account/:
    post:
      tags:
      - 'Account'
      summary: '注册账户'
      consumes:
      - 'multipart/form-data'
      produces:
      - 'application/json'
      parameters:
      - in: 'formData'
        name: 'email'
        type: 'string'
        description: '邮箱'
        required: true
      - in: 'formData'
        name: 'password'
        type: 'string'
        description: '密码'
        required: true
      # - in: 'formData'
      #   name: 'class'
      #   type: 'integer'
      #   description: '学生/组织'
      #   required: true
      - in: 'formData'
        name: 'gender'
        type: 'string'
        enum:
        - 'male/female'
        description: '性别'
        required: true
      - in: 'formData'
        name: 'nickname'
        type: 'string'
        description: '昵称'
        required: true
      responses:
        200:
          description: 'ok, 返回uid信息'
          schema:
            $ref: '#/definitions/IdResponse'
        400:
          description: 'fail'
          schema:
            $ref: '#/definitions/ErrorResponse'

  /account/self:
    get:
      tags:
      - 'Account'
      summary: '获取自身账户信息'
      responses:
        200:
          description: 'ok'
          schema:
            $ref: '#/definitions/UserInfoResponse'
        400:
          description: 'fail'
          schema:
            $ref: '#/definitions/ErrorResponse'

    put:
      tags:
      - 'Account'
      summary: '修改自身账户基本信息'
      parameters:
      - in: 'body'
        name: 'body'
        description: '账户信息'
        required: true
        schema:
          type: 'object'
          properties:
            # password:
            #   type: 'string'
            # class:
            #   type: 'integer'
            gender:
              type: 'string'
              enum:
              - 'male/female'
            nickname:
              type: 'string'
            grade:
              type: 'string'
            college:
              type: 'string'
            major:
              type: 'string'
            studentID:
              type: 'string'
            realname:
              type: 'string'

      responses:
        200:
          description: 'ok'
        400:
          description: 'fail'
          schema:
            $ref: '#/definitions/ErrorResponse'

  /account/password:
    put:
      tags:
      - 'Account'
      summary: '修改自身账户密码'
      parameters:
      - in: 'body'
        name: 'body'
        description: '账户新旧密码'
        required: true
        schema:
          type: 'object'
          properties:
            old_password:
              type: 'string'
            new_password:
              type: 'string'

      responses:
        200:
          description: 'ok'
        400:
          description: 'fail'
          schema:
            $ref: '#/definitions/ErrorResponse'

  /account/avatar:
    post:
      tags:
      - 'Account'
      summary: '修改自身账户头像'
      consumes:
      - 'multipart/form-data'
      produces:
      - 'application/json'
      parameters:
      - in: 'formData'
        name: 'file'
        type: 'file'
        description: '账户新头像'
        required: true

      responses:
        200:
          description: 'ok, 返回头像url信息'
          schema:
            $ref: '#/definitions/ImageURLResponse'
        400:
          description: 'fail'
          schema:
            $ref: '#/definitions/ErrorResponse'


  /account/{uid}:
    get:
      tags:
      - 'Account'
      summary: '获取id为uid的账户信息'
      responses:
        200:
          description: 'ok'
          schema:
            $ref: '#/definitions/UserInfoResponse'
        400:
          description: 'fail'
          schema:
            $ref: '#/definitions/ErrorResponse'

  /system/image:
    post:
      tags:
      - 'System'
      summary: '上传图片'
      consumes:
      - 'multipart/form-data'
      parameters:
      - in: 'formData'
        name: 'image'
        type: 'file'
        description: '图片'
        required: true
      responses:
        200:
          description: 'ok'
          schema:
            $ref: '#/definitions/ImageURLResponse'
        400:
          description: 'fail'
          schema:
            $ref: '#/definitions/ErrorResponse'
  
  /account/session:
    post:
      tags:
      - 'Account'
      summary: '登录'
      consumes:
      - 'application/json'
      produces:
      - 'application/json'
      parameters:
      - in: 'body'
        name: 'body'
        description: '登录信息'
        required: true
        schema:
          $ref: '#/definitions/LoginRequest'
      responses:
        200:
          description: 'ok, 返回uid信息'
          schema:
            $ref: '#/definitions/IdResponse'
        400:
          description: 'fail'
          schema:
            $ref: '#/definitions/ErrorResponse'

    delete:
      tags:
      - 'Account'
      summary: '登出'
      produces:
      - 'application/json'
      responses:
        200:
          description: 'ok'
        400:
          description: 'fail'
          schema:
            $ref: '#/definitions/ErrorResponse'

  /assignment:
    get:
      tags:
      - 'Assignment'
      summary: '获取最近20个任务'
      responses:
        200:
          description: 'ok'
          schema:
            $ref: '#/definitions/AssignmentInfoResponse'
        400:
          description: 'fail'
          schema:
            $ref: '#/definitions/ErrorResponse'

  /assignment/{pages}:
    get:
      tags:
      - 'Assignment'
      summary: '获取第pages页的20个任务'
      parameters:
      - name: 'pages'
        in: 'path'
        required: true
        description: '页数'
        type: 'integer'
      responses:
        200:
          description: 'ok'
          schema:
            $ref: '#/definitions/AssignmentInfoResponse'
        400:
          description: 'fail'
          schema:
            $ref: '#/definitions/ErrorResponse'

  /assignment/questionnaire:
    get:
      tags:
      - 'Assignment'
      summary: '获取最近20个问卷'
      responses:
        200:
          description: 'ok'
          schema:
            $ref: '#/definitions/AssignmentQInfoResponse'
        400:
          description: 'fail'
          schema:
            $ref: '#/definitions/ErrorResponse'

  /assignment/questionnaire/{pages}:
    get:
      tags:
      - 'Assignment'
      summary: '获取第pages页的20个问卷'
      parameters:
      - name: 'pages'
        in: 'path'
        required: true
        description: '页数'
        type: 'integer'
      responses:
        200:
          description: 'ok'
          schema:
            $ref: '#/definitions/AssignmentQInfoResponse'
        400:
          description: 'fail'
          schema:
            $ref: '#/definitions/ErrorResponse'

  /assignment/qa:
    get:
      tags:
      - 'Assignment'
      summary: '获取最近20个懂了么'
      responses:
        200:
          description: 'ok'
          schema:
            $ref: '#/definitions/AssignmentQAInfoResponse'
        400:
          description: 'fail'
          schema:
            $ref: '#/definitions/ErrorResponse'

  /assignment/qa/{pages}:
    get:
      tags:
      - 'Assignment'
      summary: '获取第pages页的20个懂了么'
      parameters:
      - name: 'pages'
        in: 'path'
        required: true
        description: '页数'
        type: 'integer'
      responses:
        200:
          description: 'ok'
          schema:
            $ref: '#/definitions/AssignmentQAInfoResponse'
        400:
          description: 'fail'
          schema:
            $ref: '#/definitions/ErrorResponse'

  /questionnaire/{aid}:
    get:
      tags:
      - 'Questionnaire'
      summary: '获取id=aid的问卷'
      parameters:
      - name: 'aid'
        in: 'path'
        required: true
        description: 'aid'
        type: 'integer'
      responses:
        200:
          description: 'ok'
          schema:
            $ref: '#/definitions/QuestionnaireInfoResponse'
        400:
          description: 'fail'
          schema:
            $ref: '#/definitions/ErrorResponse'

    post:
      tags:
      - 'Questionnaire'
      summary: '提交问卷'
      consumes:
      - 'application/json'
      produces:
      - 'application/json'
      parameters:
      - name: 'aid'
        in: 'path'
        required: true
        description: 'aid'
        type: 'integer'
      - in: 'body'
        name: 'body'
        description: '问卷答案信息'
        required: true
        schema:
          $ref: '#/definitions/QuestionnaireAnsRequest'
      responses:
        200:
          description: 'ok'
        400:
          description: 'fail'
          schema:
            $ref: '#/definitions/ErrorResponse'

    delete:
      tags:
      - 'Questionnaire'
      summary: '删除自己创建的问卷'
      produces:
      - 'application/json'
      parameters:
      - name: 'aid'
        in: 'path'
        required: true
        description: 'aid'
        type: 'integer'
      responses:
        200:
          description: 'ok'
        400:
          description: 'fail'
          schema:
            $ref: '#/definitions/ErrorResponse'

  /questionnaire:
    post:
      tags:
      - 'Questionnaire'
      summary: '发布一个问卷类型的任务'
      consumes:
      - 'application/json'
      produces:
      - 'application/json'
      parameters:
      - in: 'body'
        name: 'body'
        description: '问卷类型的任务信息'
        required: true
        schema:
          $ref: '#/definitions/QuestionnaireInfoRequest'
      responses:
        200:
          description: 'ok, 返回任务aid'
          schema:
            $ref: '#/definitions/IdResponse'
        400:
          description: 'fail'
          schema:
            $ref: '#/definitions/ErrorResponse'

  /questionnaire/answer/{aid}:
    get:
      tags:
      - 'Questionnaire'
      summary: '获取id=aid的问卷统计答案'
      parameters:
      - name: 'aid'
        in: 'path'
        required: true
        description: 'aid'
        type: 'integer'
      responses:
        200:
          description: 'ok'
          schema:
            $ref: '#/definitions/AnswerInfoResponse'
        400:
          description: 'fail'
          schema:
            $ref: '#/definitions/ErrorResponse'

  /qa/{aid}:
    get:
      tags:
      - 'Question & Answer'
      summary: '获取id=aid的懂了么'
      parameters:
      - name: 'aid'
        in: 'path'
        required: true
        description: 'aid'
        type: 'integer'
      responses:
        200:
          description: 'ok'
          schema:
            $ref: '#/definitions/QAInfoResponse'
        400:
          description: 'fail'
          schema:
            $ref: '#/definitions/ErrorResponse'

    post:
      tags:
      - 'Question & Answer'
      summary: '回答懂了么'
      consumes:
      - 'application/json'
      produces:
      - 'application/json'
      parameters:
      - name: 'aid'
        in: 'path'
        required: true
        description: 'aid'
        type: 'integer'
      - in: 'body'
        name: 'body'
        description: '懂了么回答信息'
        required: true
        schema:
          $ref: '#/definitions/QAnswerRequest'
      responses:
        200:
          description: 'ok 返回回答qaid信息'
          schema:
            $ref: '#/definitions/IdResponse'
        400:
          description: 'fail'
          schema:
            $ref: '#/definitions/ErrorResponse'

    delete:
      tags:
      - 'Question & Answer'
      summary: '删除自己创建的懂了么'
      produces:
      - 'application/json'
      parameters:
      - name: 'aid'
        in: 'path'
        required: true
        description: 'aid'
        type: 'integer'
      responses:
        200:
          description: 'ok'
        400:
          description: 'fail'
          schema:
            $ref: '#/definitions/ErrorResponse'

  /qa:
    post:
      tags:
      - 'Question & Answer'
      summary: '发布一个懂了么的任务'
      consumes:
      - 'application/json'
      produces:
      - 'application/json'
      parameters:
      - in: 'body'
        name: 'body'
        description: '懂了么的任务信息'
        required: true
        schema:
          $ref: '#/definitions/QAInfoRequest'
      responses:
        200:
          description: 'ok, 返回任务aid'
          schema:
            $ref: '#/definitions/IdResponse'
        400:
          description: 'fail'
          schema:
            $ref: '#/definitions/ErrorResponse'

  # /qa/best/{aid}:
  #   delete:
  #     tags:
  #     - 'Question & Answer'
  #     summary: '取消采纳懂了么回答'
  #     produces:
  #     - 'application/json'
  #     parameters:
  #     - name: 'aid'
  #       in: 'path'
  #       required: true
  #       description: '懂了么任务的aid'
  #       type: 'integer'
  #     responses:
  #       200:
  #         description: 'ok'
  #       400:
  #         description: 'fail'
  #         schema:
  #           $ref: '#/definitions/ErrorResponse'

  /qa/{aid}/{qaid}:
    put:
      tags:
      - 'Question & Answer'
      summary: '采纳懂了么回答'
      produces:
      - 'application/json'
      parameters:
      - name: 'aid'
        in: 'path'
        required: true
        description: '懂了么的aid'
        type: 'integer'
      - name: 'qaid'
        in: 'path'
        required: true
        description: '懂了么回答的qaid'
        type: 'integer'
      responses:
        200:
          description: 'ok'
        400:
          description: 'fail'
          schema:
            $ref: '#/definitions/ErrorResponse'

    delete:
      tags:
      - 'Question & Answer'
      summary: '删除懂了么回答'
      produces:
      - 'application/json'
      parameters:
      - name: 'qaid'
        in: 'path'
        required: true
        description: '懂了么回答的qaid'
        type: 'integer'
      responses:
        200:
          description: 'ok'
        400:
          description: 'fail'
          schema:
            $ref: '#/definitions/ErrorResponse'

  /coin/self:
    get:
      tags:
      - 'Coin'
      summary: '获取自身闲钱数量'
      responses:
        200:
          description: 'ok'
          schema:
            $ref: '#/definitions/CoinResponse'
        400:
          description: 'fail'
          schema:
            $ref: '#/definitions/ErrorResponse'

    post:
      tags:
      - 'Coin'
      summary: '充值100闲钱'
      responses:
        200:
          description: 'ok, 返回闲钱数'
          schema:
            $ref: '#/definitions/CoinResponse'
        400:
          description: 'fail'
          schema:
            $ref: '#/definitions/ErrorResponse'

    delete:
      tags:
      - 'Coin'
      summary: '不小心弄丢50闲钱'
      responses:
        200:
          description: 'ok, 返回闲钱数'
          schema:
            $ref: '#/definitions/CoinResponse'
        400:
          description: 'fail'
          schema:
            $ref: '#/definitions/ErrorResponse'

  /coin/{uid}:
    post:
      tags:
      - 'Coin'
      summary: '给予一些闲钱'
      consumes:
      - 'application/json'
      produces:
      - 'application/json'
      parameters:
      - in: 'body'
        name: 'body'
        description: '闲钱数量'
        required: true
        schema:
          $ref: '#/definitions/CoinRequest'
      responses:
        200:
          description: 'ok, 返回剩余闲钱'
          schema:
            $ref: '#/definitions/CoinResponse'
        400:
          description: 'fail'
          schema:
            $ref: '#/definitions/ErrorResponse'

definitions:

  ErrorResponse:
    type: 'object'
    properties:
      msg:
        type: 'string'

  User:
    type: 'object'
    properties:
      Email:
        type: 'string'
      # class:
      #   type: 'integer'
      Gender:
        type: 'string'
      Nickname:
        type: 'string'
      Avatar:
        type: 'string'
      Grade:
        type: 'string'
      College:
        type: 'string'
      Major:
        type: 'string'
      StudentID:
        type: 'string'
      RealName:
        type: 'string'

  UserInfoResponse:
    allOf:
    - properties:
        Uid:
          type: 'integer'
    - $ref: '#/definitions/User'

  OtherUserInfoResponse:
    type: 'object'
    properties:
      class:
        type: 'integer'
      nickname:
        type: 'string'
      avatar:
        type: 'string'
      grade:
        type: 'string'
      college:
        type: 'string'
      major:
        type: 'string'
      studentID:
        type: 'string'


  ImageURLResponse:
    type: 'object'
    properties:
      url:
        type: 'string'

  LoginRequest:
    type: 'object'
    properties:
      email:
        type: 'string'
      password:
        type: 'string'

  AssignmentInfoResponse:
    type: 'object'
    properties:
      assignments:
        type: 'array'
        items:
          type: 'object'
          properties:
            title:
              type: 'string'
            description:
              type: 'string'
            type: 
              type: 'string'
              enum:
              - 'questionnaire'
              - 'qa'
            aid:
              type: 'integer'
            creator:
              type: 'string'
            coin:
              type: 'integer'
            createTime:
              type: 'string'
            startTime:
              type: 'string'
            endTime:
              type: 'string'

  AssignmentQInfoResponse:
    type: 'object'
    properties:
      assignments:
        type: 'array'
        items:
          type: 'object'
          properties:
            title:
              type: 'string'
            description:
              type: 'string'
            type: 
              type: 'string'
              enum:
              - 'questionnaire'
            aid:
              type: 'integer'
            creator:
              type: 'string'
            coin:
              type: 'integer'
            unit:
              type: 'integer'
            createTime:
              type: 'string'
            startTime:
              type: 'string'
            endTime:
              type: 'string'

  AssignmentQAInfoResponse:
    type: 'object'
    properties:
      assignments:
        type: 'array'
        items:
          type: 'object'
          properties:
            title:
              type: 'string'
            description:
              type: 'string'
            type: 
              type: 'string'
              enum:
              - 'qa'
            aid:
              type: 'integer'
            creator:
              type: 'string'
            coin:
              type: 'integer'
            createTime:
              type: 'string'
            startTime:
              type: 'string'
            endTime:
              type: 'string'

  Question:
    type: 'object'
    properties:
      qid:
        type: 'integer'
      titie:
        type: 'string'
      aid:
        type: 'integer'
      type:
        type: 'string'
        enum:
        - 'single'
        - 'multi'
        - 'input'

  QuestionRequest:
    type: 'object'
    properties:
      titie:
        type: 'string'
      type:
        type: 'string'
        enum:
        - 'single'
        - 'multi'
        - 'input'

  Option:
    type: 'object'
    properties:
      oid:
        type: 'integer'
      value:
        type: 'string'
      qid:
        type: 'integer'
      aid:
        type: 'integer'

  OptionRequest:
    type: 'object'
    properties:
      questionIndex:
        type: 'integer'
      value:
        type: 'string'

  Answer:
    type: 'object'
    properties:
      uid:
        type: 'integer'
      aid:
        type: 'integer'
      qid:
        type: 'integer'
      oid:
        type: 'integer'
      value:
        type: 'string'
      timestamp:
        type: 'string'

  AnswerRequest:
    type: 'object'
    properties:
      uid:
        type: 'integer'
      qid:
        type: 'integer'
      oid:
        type: 'integer'
      value:
        type: 'string'
      timestamp:
        type: 'string'
  
  QuestionnaireInfoRequest:
    allOf:
    # - $ref: '#/definitions/AssignmentInfoResponse'
    - properties:
        title:
          type: 'string'
        description:
          type: 'string'
        # type: 
        #   type: 'string'
        #   enum:
        #   - 'questionnaire'
        # creator:
        #   type: 'integer'
        coin:
          type: 'integer'
        copy:
          type: 'integer'
        createTime:
          type: 'string'
        startTime:
          type: 'string'
        endTime:
          type: 'string'
        questions:
          type: 'array'
          items:
            allOf:
            - $ref: '#/definitions/QuestionRequest'
        options:
          type: 'array'
          items:
            allOf:
            - $ref: '#/definitions/OptionRequest'
    # - properties:
    #     data:
    #       type: 'array'
    #       items:
    #         allOf:
    #         - $ref: '#/definitions/Question'
    #         - properties:
    #             data:
    #               type: 'array'
    #               items:
    #                 allOf:
    #                 - $ref: '#/definitions/Option'
            
  QuestionnaireInfoResponse:
    allOf:
    # - $ref: '#/definitions/AssignmentInfoResponse'
    - properties:
        title:
          type: 'string'
        description:
          type: 'string'
        type: 
          type: 'string'
          enum:
          - 'questionnaire'
          - 'qa'
        aid:
          type: 'integer'
        creator:
          type: 'string'
        coin:
          type: 'integer'
        unit:
          type: 'integer'
        createTime:
          type: 'string'
        startTime:
          type: 'string'
        endTime:
          type: 'string'
        questions:
          type: 'array'
          items:
            allOf:
            - $ref: '#/definitions/Question'
        options:
          type: 'array'
          items:
            allOf:
            - $ref: '#/definitions/Option'

  AnswerInfoResponse:
    allOf:
      - $ref: '#/definitions/QuestionnaireInfoResponse'
      - properties:
          oid1:
            type: 'array'
            items:
              type: 'object'
              properties:
                user:
                  type: 'string'
                  enum:
                  - 'UserID@Nickname'
                value:
                  type: 'string'
                timestamp:
                  type: 'string'
          oid2:
            type: 'array'
            items:
              type: 'object'
              properties:
                user:
                  type: 'string'
                  enum:
                  - 'UserID@Nickname'
                value:
                  type: 'string'
                timestamp:
                  type: 'string'


  QuestionnaireAnsRequest:
    type: 'object'
    properties:
      answers:
        type: 'array'
        items:
          allOf:
          - $ref: '#/definitions/AnswerRequest'

  QAInfoRequest:
    allOf:
    # - $ref: '#/definitions/AssignmentInfoResponse'
    - properties:
        title:
          type: 'string'
        description:
          type: 'string'
        # type: 
        #   type: 'string'
        #   enum:
        #   - 'qa'
        # creator:
        #   type: 'integer'
        coin:
          type: 'integer'
        createTime:
          type: 'string'
        startTime:
          type: 'string'
        endTime:
          type: 'string'
        detail:
          type: 'string'

  QAnswerRequest:
    type: 'object'
    properties:
      # uid:
      #   type: 'integer'
      pid:
        type: 'integer'
      answer:
        type: 'string'
      timestamp:
        type: 'string'

  QAnswerResponse:
    type: 'object'
    properties:
      user:
        type: 'string'
        enum:
        - 'UserID@Nickname'
      aid:
        type: 'integer'
      qaid:
        type: 'integer'
      pid:
        type: 'integer'
      answer:
        type: 'string'
      timestamp:
        type: 'string'

  QAnswerBestResponse:
    type: 'object'
    properties:
      user:
        type: 'string'
        enum:
        - 'UserID@Nickname'
      aid:
        type: 'integer'
      pid:
        type: 'integer'
      answer:
        type: 'string'
      timestamp:
        type: 'string'

  QAnswerInfoRequest:
    type: 'array'
    items:
      allOf:
      - $ref: '#/definitions/QAnswerRequest'

  QAInfoResponse:
    allOf:
    # - $ref: '#/definitions/AssignmentInfoResponse'
    - properties:
        title:
          type: 'string'
        description:
          type: 'string'
        type: 
          type: 'string'
          enum:
          - 'qa'
        aid:
          type: 'integer'
        creator:
          type: 'string'
        createTime:
          type: 'string'
        startTime:
          type: 'string'
        endTime:
          type: 'string'
        pid:
          type: 'integer'
        detail:
          type: 'string'
        best:
          allOf:
          - $ref: '#/definitions/QAnswerBestResponse'
        answers:
          type: 'array'
          items:
            allOf:
            - $ref: '#/definitions/QAnswerResponse'

  IdResponse:
    type: 'object'
    properties:
      id:
        type: 'integer'

  CoinResponse:
    type: 'object'
    properties:
      coin:
        type: 'integer'

  CoinRequest:
    type: 'object'
    properties:
      coin:
        type: 'integer'

externalDocs:
  description: 'api.yaml'
  url: 'http://swagger.io'